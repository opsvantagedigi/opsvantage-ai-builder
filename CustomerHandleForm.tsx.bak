'use client';

import React from 'react';
import { CustomerData } from './customer-actions';

interface CustomerHandleFormProps {
    userEmail: string;
    userName: string;
    onSubmit: (data: CustomerData) => void;
    onCancel: () => void;
    isLoading: boolean;
}

export function CustomerHandleForm({ userEmail, userName, onSubmit, onCancel, isLoading }: CustomerHandleFormProps) {
    const [formData, setFormData] = React.useState({
        firstName: userName.split(' ')[0] || '',
        lastName: userName.split(' ').slice(1).join(' ') || '',
        email: userEmail,
        address: '',
        zipcode: '',
        city: '',
        state: '',
        country: 'US',
        phone: '',
    });

    const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
        setFormData({ ...formData, [e.target.name]: e.target.value });
    };

    const handleSubmit = (e: React.FormEvent) => {
        e.preventDefault();
        const customerData: CustomerData = {
            email: formData.email,
            name: { firstName: formData.firstName, lastName: formData.lastName },
            address: {
                street: formData.address,
                number: '1', // Defaulting for now as form doesn't have it
                zipcode: formData.zipcode,
                city: formData.city,
                country: formData.country,
            },
            phone: {
                countryCode: '1', // Default US
                areaCode: formData.phone.slice(0, 3) || '555',
                subscriberNumber: formData.phone.slice(3) || '5555555',
            },
        };
        onSubmit(customerData);
    };

    return (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-lg p-6 max-w-md w-full text-slate-900">
                <h2 className="text-xl font-bold mb-4">Complete Registration</h2>
                <form onSubmit={handleSubmit} className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                        <input name="firstName" placeholder="First Name" value={formData.firstName} onChange={handleChange} required className="border p-2 rounded" />
                        <input name="lastName" placeholder="Last Name" value={formData.lastName} onChange={handleChange} required className="border p-2 rounded" />
                    </div>
                    <input name="email" type="email" placeholder="Email" value={formData.email} onChange={handleChange} required className="border p-2 rounded w-full" />
                    <input name="address" placeholder="Address" value={formData.address} onChange={handleChange} required className="border p-2 rounded w-full" />
                    <div className="grid grid-cols-2 gap-4">
                        <input name="city" placeholder="City" value={formData.city} onChange={handleChange} required className="border p-2 rounded" />
                        <input name="zipcode" placeholder="Zip Code" value={formData.zipcode} onChange={handleChange} required className="border p-2 rounded" />
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                        <input name="state" placeholder="State/Province" value={formData.state} onChange={handleChange} required className="border p-2 rounded" />
                        <input name="country" placeholder="Country Code (US)" value={formData.country} onChange={handleChange} required className="border p-2 rounded" maxLength={2} />
                    </div>
                    <input name="phone" placeholder="Phone" value={formData.phone} onChange={handleChange} required className="border p-2 rounded w-full" />

                    <div className="flex justify-end gap-2 mt-4">
                        <button type="button" onClick={onCancel} className="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded">Cancel</button>
                        <button type="submit" disabled={isLoading} className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-500 disabled:opacity-50">
                            {isLoading ? 'Processing...' : 'Submit'}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    );
}
